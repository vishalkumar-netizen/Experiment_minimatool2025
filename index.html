<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Master Tool | By Vishal Kumar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus+Jakarta+Sans', sans-serif; }
        .drag-active { border-color: #3b82f6; background-color: #eff6ff; transform: scale(1.01); }
        .dragging { opacity: 0.5; border: 2px dashed #3b82f6; }
        .tab-btn.active { color: #2563eb; border-bottom: 3px solid #2563eb; }
        .sort-pill { font-size: 10px; font-weight: 800; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; }
        .pill-l { background: #dcfce7; color: #166534; } 
        .pill-i { background: #dbeafe; color: #1e40af; } 
        .pill-m { background: #fef9c3; color: #854d0e; } 
        .pill-h { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-12 text-slate-900">

    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold flex items-center justify-center gap-3">
                <i data-lucide="zap" class="w-10 h-10 text-yellow-500 fill-current"></i>
                PDF Master Tool
            </h1>
            <p class="text-slate-500 font-medium mt-2">No creepy servers. Just you and your files. ðŸ¤™</p>
            <div class="mt-4 inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-lg">
                <i data-lucide="user" class="w-4 h-4"></i>
                Made by Vishal Kumar
            </div>
        </header>

        <!-- Tabs -->
        <nav class="flex justify-center mb-8 border-b border-slate-200">
            <button onclick="switchTab('merge')" id="tab-merge" class="tab-btn active px-8 py-3 font-extrabold text-slate-400 hover:text-blue-500 transition-all flex items-center gap-2">
                MASH 'EM (MERGE)
            </button>
            <button onclick="switchTab('split')" id="tab-split" class="tab-btn px-8 py-3 font-extrabold text-slate-400 hover:text-blue-500 transition-all flex items-center gap-2">
                RIP 'EM (SPLIT)
            </button>
        </nav>

        <!-- MERGE SECTION -->
        <section id="view-merge" class="bg-white rounded-3xl shadow-2xl border border-slate-100 overflow-hidden">
            <div class="p-8">
                <div id="drop-zone-merge" class="border-4 border-dashed border-slate-200 rounded-2xl p-12 text-center hover:border-blue-400 hover:bg-blue-50 transition-all cursor-pointer relative group">
                    <input type="file" id="file-input-merge" multiple accept=".pdf" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    <div class="pointer-events-none">
                        <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:rotate-12 transition-transform">
                            <i data-lucide="plus" class="w-10 h-10"></i>
                        </div>
                        <h3 class="text-2xl font-black">Chuck your PDFs here</h3>
                        <p class="text-slate-400 font-bold mt-1">Everything stays on your machine, lol.</p>
                    </div>
                </div>
            </div>

            <!-- Toolbar -->
            <div id="merge-toolbar" class="hidden px-8 py-4 bg-slate-50 border-y border-slate-100 flex flex-wrap gap-3 justify-between items-center">
                <div class="flex items-center gap-2">
                    <button onclick="sortFiles('cap')" class="px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-sm font-black flex items-center gap-2 shadow-lg active:scale-95 transition-all">
                        <i data-lucide="plane" class="w-4 h-4"></i> CAP A1 SORT
                    </button>
                    <button onclick="sortFiles('num')" class="px-4 py-2.5 bg-white border border-slate-200 rounded-xl text-sm font-bold hover:bg-slate-50">1, 2, 3...</button>
                    <button id="ai-rename-btn" onclick="suggestMergedName()" class="px-4 py-2.5 bg-indigo-50 border border-indigo-100 text-indigo-700 rounded-xl text-sm font-bold flex items-center gap-2 hover:bg-indigo-100">
                        <i data-lucide="sparkles" class="w-4 h-4"></i> AI Rename
                    </button>
                </div>
                <button onclick="clearMergeFiles()" class="text-sm text-red-500 font-black hover:underline">Clear all</button>
            </div>

            <ul id="file-list-merge" class="hidden p-8 space-y-4 bg-slate-50/50 max-h-[500px] overflow-y-auto"></ul>

            <div class="p-8 bg-white border-t border-slate-100">
                <div class="flex flex-col sm:flex-row gap-4 items-center">
                    <input type="text" id="custom-filename" placeholder="Name your new file..." class="px-5 py-4 border-2 border-slate-100 rounded-2xl text-base w-full focus:ring-4 focus:ring-blue-100 focus:border-blue-500 focus:outline-none font-bold outline-none transition-all">
                    <button id="merge-btn" onclick="mergePDFs()" disabled class="w-full sm:w-auto px-10 py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 text-white rounded-2xl font-black shadow-xl transition-all flex items-center justify-center gap-2 whitespace-nowrap transform active:scale-95">
                        DO THE THING ðŸš€
                    </button>
                </div>
                <div id="status-msg-merge" class="mt-4 text-center font-bold text-blue-600 hidden">Wait a sec, mashing them up...</div>
            </div>
        </section>

        <!-- SPLIT SECTION -->
        <section id="view-split" class="hidden bg-white rounded-3xl shadow-2xl border border-slate-100 overflow-hidden">
            <div class="p-8">
                <div id="drop-zone-split" class="border-4 border-dashed border-slate-200 rounded-2xl p-12 text-center hover:border-purple-400 hover:bg-purple-50 transition-all cursor-pointer relative group">
                    <input type="file" id="file-input-split" accept=".pdf" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    <div class="pointer-events-none">
                        <div class="w-16 h-16 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="scissors" class="w-10 h-10"></i>
                        </div>
                        <h3 class="text-2xl font-black">Drop a PDF to rip it</h3>
                        <p class="text-slate-400 font-bold mt-1">One page per file, zipped up. Boom.</p>
                    </div>
                </div>
                
                <div id="split-file-info" class="hidden mt-4 p-6 bg-purple-50 rounded-2xl flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-purple-600 text-white rounded-xl shadow-lg">
                            <i data-lucide="file-text" class="w-6 h-6"></i>
                        </div>
                        <span id="split-filename" class="font-black text-slate-800 uppercase tracking-tight truncate max-w-[200px]">doc.pdf</span>
                    </div>
                    <button onclick="clearSplitFile()" class="p-2 text-slate-400 hover:text-red-500 transition-colors">
                        <i data-lucide="x-circle" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div class="p-8 bg-white border-t border-slate-100">
                <button id="split-btn" onclick="splitPDF()" disabled class="w-full px-10 py-4 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-200 text-white rounded-2xl font-black shadow-xl transition-all flex items-center justify-center gap-2 text-lg">
                    GRAB THE ZIP ðŸ“¦
                </button>
                <div id="status-msg-split" class="mt-4 text-center font-bold text-purple-600 hidden">Ripping pages apart...</div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-12 py-6 text-center">
            <p class="text-slate-400 text-sm font-bold flex items-center justify-center gap-2">
                Built with <i data-lucide="heart" class="w-4 h-4 text-red-500 fill-current"></i> by <span class="text-slate-900 font-black">Vishal Kumar</span>
            </p>
        </footer>
    </div>

    <a id="download-link" class="hidden"></a>

    <script>
        const apiKey = ""; 
        lucide.createIcons();
        let mergeFiles = [];
        let splitFile = null;
        let dragSrcEl = null;

        const views = { merge: document.getElementById('view-merge'), split: document.getElementById('view-split') };
        const tabs = { merge: document.getElementById('tab-merge'), split: document.getElementById('tab-split') };

        function switchTab(tabName) {
            Object.values(views).forEach(el => el.classList.add('hidden'));
            views[tabName].classList.remove('hidden');
            Object.values(tabs).forEach(el => el.classList.remove('active'));
            tabs[tabName].classList.add('active');
        }

        async function callGemini(prompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "Suggest a short, cool filename for a PDF based on these files. Use underscores, no spaces." }] }
                    })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || null;
            } catch (err) { return null; }
        }

        const dropZoneMerge = document.getElementById('drop-zone-merge');
        const fileInputMerge = document.getElementById('file-input-merge');
        const fileListMerge = document.getElementById('file-list-merge');
        const mergeBtn = document.getElementById('merge-btn');
        const customFilenameInput = document.getElementById('custom-filename');

        setupDragVisuals(dropZoneMerge);
        dropZoneMerge.addEventListener('drop', (e) => handleMergeFiles(e.dataTransfer.files));
        fileInputMerge.addEventListener('change', (e) => { handleMergeFiles(e.target.files); fileInputMerge.value = ''; });

        function handleMergeFiles(files) {
            const validFiles = Array.from(files).filter(f => f.name.toLowerCase().endsWith('.pdf'));
            mergeFiles = [...mergeFiles, ...validFiles];
            renderMergeList();
        }

        function clearMergeFiles() { mergeFiles = []; renderMergeList(); }
        function removeMergeFile(index) { mergeFiles.splice(index, 1); renderMergeList(); }

        function sortFiles(type) {
            if (type === 'cap') {
                mergeFiles.sort((a, b) => {
                    const nameA = a.name.toLowerCase();
                    const nameB = b.name.toLowerCase();
                    const isHeliA = nameA.includes('haorg');
                    const isHeliB = nameB.includes('haorg');
                    if (isHeliA !== isHeliB) return isHeliA ? 1 : -1;
                    const getCat = (n) => n.includes('l') ? 1 : (n.includes('i') ? 2 : (n.includes('m') ? 3 : 4));
                    const catA = getCat(nameA); const catB = getCat(nameB);
                    if (catA !== catB) return catA - catB;
                    return new Intl.Collator(undefined, {numeric: true}).compare(nameA, nameB);
                });
            } else {
                mergeFiles.sort((a, b) => new Intl.Collator(undefined, {numeric: true}).compare(a.name, b.name));
            }
            renderMergeList();
        }

        async function suggestMergedName() {
            if (mergeFiles.length < 1) return;
            const btn = document.getElementById('ai-rename-btn');
            btn.innerHTML = 'Thinking...';
            const suggestion = await callGemini(mergeFiles.map(f => f.name).join(', '));
            if (suggestion) customFilenameInput.value = suggestion.trim();
            btn.innerHTML = '<i data-lucide="sparkles" class="w-4 h-4"></i> AI Rename';
            lucide.createIcons();
        }

        function renderMergeList() {
            fileListMerge.innerHTML = '';
            const tool = document.getElementById('merge-toolbar');
            if (mergeFiles.length > 0) {
                fileListMerge.classList.remove('hidden');
                tool.classList.remove('hidden');
                mergeBtn.disabled = false;
            } else {
                fileListMerge.classList.add('hidden');
                tool.classList.add('hidden');
                mergeBtn.disabled = true;
            }

            mergeFiles.forEach((file, index) => {
                const n = file.name.toLowerCase();
                let label = ''; let pill = '';
                if (n.includes('haorg')) { label = 'Heli'; pill = 'pill-h'; }
                else if (n.includes('l')) { label = 'Takeoff'; pill = 'pill-l'; }
                else if (n.includes('i')) { label = 'IAC'; pill = 'pill-i'; }
                else if (n.includes('m')) { label = 'Minima'; pill = 'pill-m'; }

                const li = document.createElement('li');
                li.draggable = true;
                li.className = 'bg-white border-2 border-slate-100 rounded-2xl p-4 flex items-center justify-between shadow-sm cursor-grab active:cursor-grabbing transition-all hover:border-blue-200';
                li.innerHTML = `
                    <div class="flex items-center gap-4 overflow-hidden pointer-events-none w-full">
                        <div class="shrink-0 w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black">
                            ${index + 1}
                        </div>
                        <div class="min-w-0">
                            ${label ? `<span class="sort-pill ${pill}">${label}</span>` : ''}
                            <p class="font-bold text-slate-800 truncate uppercase tracking-tight">${file.name}</p>
                        </div>
                    </div>
                    <button onclick="removeMergeFile(${index})" class="p-2 text-slate-300 hover:text-red-500">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </button>
                `;
                li.addEventListener('dragstart', () => { dragSrcEl = index; li.classList.add('dragging'); });
                li.addEventListener('dragover', (e) => e.preventDefault());
                li.addEventListener('drop', () => {
                    const item = mergeFiles[dragSrcEl];
                    mergeFiles.splice(dragSrcEl, 1);
                    mergeFiles.splice(index, 0, item);
                    renderMergeList();
                });
                fileListMerge.appendChild(li);
            });
            lucide.createIcons();
        }

        async function mergePDFs() {
            setLoading('merge', true);
            try {
                const mergedPdf = await PDFLib.PDFDocument.create();
                for (const f of mergeFiles) {
                    const pdf = await PDFLib.PDFDocument.load(await f.arrayBuffer());
                    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    pages.forEach(p => mergedPdf.addPage(p));
                }
                const bytes = await mergedPdf.save();
                saveAs(new Blob([bytes]), (customFilenameInput.value || 'mashup') + '.pdf');
            } catch (e) { alert("Opps, something went wrong."); }
            finally { setLoading('merge', false); }
        }

        const dropZoneSplit = document.getElementById('drop-zone-split');
        const fileInputSplit = document.getElementById('file-input-split');
        const splitBtn = document.getElementById('split-btn');
        const splitInfo = document.getElementById('split-file-info');

        setupDragVisuals(dropZoneSplit);
        dropZoneSplit.addEventListener('drop', (e) => { const f = e.dataTransfer.files[0]; if(f) setSplitFile(f); });
        fileInputSplit.addEventListener('change', (e) => { if(e.target.files[0]) setSplitFile(e.target.files[0]); });

        function setSplitFile(f) {
            splitFile = f;
            document.getElementById('split-filename').textContent = f.name;
            dropZoneSplit.classList.add('hidden');
            splitInfo.classList.remove('hidden');
            splitBtn.disabled = false;
        }

        function clearSplitFile() {
            splitFile = null;
            dropZoneSplit.classList.remove('hidden');
            splitInfo.classList.add('hidden');
            splitBtn.disabled = true;
        }

        async function splitPDF() {
            setLoading('split', true);
            try {
                const source = await PDFLib.PDFDocument.load(await splitFile.arrayBuffer());
                const zip = new JSZip();
                for (let i = 0; i < source.getPageCount(); i++) {
                    const doc = await PDFLib.PDFDocument.create();
                    const [page] = await doc.copyPages(source, [i]);
                    doc.addPage(page);
                    zip.file(`page_${i + 1}.pdf`, await doc.save());
                }
                const content = await zip.generateAsync({type:"blob"});
                saveAs(content, `ripped_${splitFile.name}.zip`);
            } catch (e) { alert("Rip failed. Sorry homie."); }
            finally { setLoading('split', false); }
        }

        function setupDragVisuals(el) {
            el.addEventListener('dragenter', (e) => { e.preventDefault(); el.classList.add('drag-active'); });
            el.addEventListener('dragover', (e) => e.preventDefault());
            el.addEventListener('dragleave', () => el.classList.remove('drag-active'));
            el.addEventListener('drop', () => el.classList.remove('drag-active'));
        }

        function setLoading(t, l) {
            const m = document.getElementById(`status-msg-${t}`);
            const b = document.getElementById(`${t}-btn`);
            if(l) { m.classList.remove('hidden'); b.disabled = true; }
            else { m.classList.add('hidden'); b.disabled = false; }
        }
    </script>
</body>
</html>
